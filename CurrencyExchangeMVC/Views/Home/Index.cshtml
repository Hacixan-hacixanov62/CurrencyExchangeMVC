@model CurrencyConverterModel

@{
    ViewData["Title"] = "Currency Converter";
}

<div class="container">
    <h2>Currency Converter</h2>
    <form asp-action="Convert" method="post">

        <div class="amount">
            <p>Enter Amount</p>
            <input asp-for="Amount" type="number" min="1" step="any">
        </div>

        <div class="dropdown">

            <div class="from">
                <p>From</p>
                <div class="select-container">
                    <img id="from-flag" src="https://flagsapi.com/KR/flat/64.png">
                    <select asp-for="FromCurrency" id="from-currency">
                        @foreach (var currency in CountryList.Currencies)
                        {
                            <option value="@currency.Key">@currency.Key</option>
                        }
                    </select>
                </div>
            </div>

            <i class="fa-solid fa-arrow-right-arrow-left"></i>

            <div class="to">
                <p>To</p>
                <div class="select-container">
                    <img id="to-flag" src="https://flagsapi.com/IN/flat/64.png">
                    <select asp-for="ToCurrency" id="to-currency">
                        @foreach (var currency in CountryList.Currencies)
                        {
                            <option value="@currency.Key">@currency.Key</option>
                        }
                    </select>
                </div>
            </div>

        </div>
        <div class="msg">@Model.Result</div>
        <button type="submit">get Exchange Rate</button>
    </form>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fromCurrency = document.getElementById('from-currency');
            const toCurrency = document.getElementById('to-currency');
            const fromFlag = document.getElementById('from-flag');
            const toFlag = document.getElementById('to-flag');

            // Initialize with default values
            updateFlag(fromCurrency, fromFlag);
            updateFlag(toCurrency, toFlag);

            // Add event listeners
            fromCurrency.addEventListener('change', function() {
                updateFlag(this, fromFlag);
            }); 

            toCurrency.addEventListener('change', function() {
                updateFlag(this, toFlag);
            });

            function updateFlag(selectElement, flagElement) {
                const currencyCode = selectElement.value;
                const countryCode = getCountryCode(currencyCode);
                if (countryCode) {
                    flagElement.src = `https://flagsapi.com/${countryCode}/flat/64.png`;
                }
            }

            function getCountryCode(currencyCode) {
                const currencies = @Html.Raw(Json.Serialize(CountryList.Currencies));
                return currencies[currencyCode];
            }
        });
    </script>
}